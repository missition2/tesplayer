<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificações Push</title>
    <link rel="manifest" href="manifest.json" />
    <script src="frontend.js"></script>
</head>
<body>
    <h1>Notificação Push no iPhone/iPad</h1>
    
    <div>
        <label for="title">Título da Notificação:</label>
        <input type="text" id="title" placeholder="Digite o título">
    </div>
    <div>
        <label for="body">Texto da Notificação:</label>
        <input type="text" id="body" placeholder="Digite o texto">
    </div>
    <div>
        <label for="imageUrl">URL da Imagem (Opcional):</label>
        <input type="text" id="imageUrl" placeholder="URL da imagem">
    </div>
    <div>
        <label for="notificationUrl">URL de destino:</label>
        <input type="text" id="notificationUrl" placeholder="URL ao clicar na notificação">
    </div>

    <button onclick="subscribeAndSendNotification()">Enviar Notificação</button>

    <script>
        // Registra o Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/serviceworker.js')
                .then(function(registration) {
                    console.log('Service Worker registrado com sucesso:', registration);
                })
                .catch(function(error) {
                    console.log('Erro ao registrar o Service Worker:', error);
                });
        }

        // Função que solicita a permissão para notificações e envia a notificação
        function subscribeAndSendNotification() {
            Notification.requestPermission().then(function(permission) {
                if (permission === 'granted') {
                    // Se a permissão for concedida, vamos configurar a notificação
                    const title = document.getElementById('title').value;
                    const body = document.getElementById('body').value;
                    const imageUrl = document.getElementById('imageUrl').value;
                    const notificationUrl = document.getElementById('notificationUrl').value;

                    // Definir os dados da notificação
                    const notificationData = {
                        title: title,
                        body: body,
                        image: imageUrl,
                        url: notificationUrl
                    };

                    // Enviar a notificação
                    sendNotification(notificationData);
                } else {
                    alert('Você precisa permitir notificações!');
                }
            });
        }

        // Função que envia a notificação
        function sendNotification(notificationData) {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(function(serviceWorker) {
                    serviceWorker.showNotification(notificationData.title, {
                        body: notificationData.body,
                        icon: 'icon.png', // Coloque o caminho para o ícone desejado
                        image: notificationData.image, // A imagem configurada pelo usuário
                        data: {
                            url: notificationData.url // URL ao clicar na notificação
                        }
                    });

                    console.log('Notificação enviada:', notificationData);
                });
            }
        }
    </script>
</body>
</html>
